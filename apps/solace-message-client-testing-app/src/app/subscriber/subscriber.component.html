<mat-card [formGroup]="form">
  <mat-card-content>
    <header>Subscriber</header>
    <span class="sub-title">Subscribe to a topic to receive messages published to that destination.</span>

    <section class="subscription" [formGroupName]="SUBSCRIPTION">
      <!-- Topic -->
      <mat-form-field>
        <mat-label>Topic</mat-label>
        <input matInput [formControlName]="TOPIC">
        <!-- Subscribe/Unsubscribe -->
      </mat-form-field>
      <button mat-stroked-button color="primary" (click)="onSubscribe()" *ngIf="!isSubscribed" [disabled]="form.invalid" class="subscribe">Subscribe</button>
      <button mat-stroked-button color="primary" (click)="onUnsubscribe()" *ngIf="isSubscribed" [disabled]="form.invalid" class="unsubscribe">Unsubscribe</button>
    </section>

    <!-- Messages -->
    <sci-viewport class="messages">
      <section *ngFor="let messageListItem of messageListItems" class="message">
        <label>Destination:</label>
        <span class="topic">{{messageListItem.envelope.message.getDestination().getName()}}</span>

        <label>Timestamp:</label>
        <span>{{messageListItem.timestamp | date:'HH:mm:ss'}}</span>

        <label>Type:</label>
        <span>{{messageListItem.type}}</span>

        <ng-container *ngIf="messageListItem.envelope.params?.size">
          <label>Named segments:</label>
          <span>{{messageListItem.envelope.params | appStringifyMap}}</span>
        </ng-container>

        <ng-container *ngIf="messageListItem.envelope.headers?.size">
          <label>Headers:</label>
          <span>{{messageListItem.envelope.headers | appStringifyMap}}</span>
        </ng-container>

        <label>Details:</label>
        <sci-viewport class="content">{{messageListItem.details}}</sci-viewport>

        <label>Payload:</label>
        <sci-viewport class="content">{{messageListItem.text || messageListItem.binary}}</sci-viewport>

        <button mat-mini-fab class="delete" color="primary" (click)="onMessageDelete(messageListItem)">
          <mat-icon>delete</mat-icon>
        </button>
      </section>
    </sci-viewport>
  </mat-card-content>

  <mat-card-actions>
    <button mat-stroked-button (click)="onClear()" *ngIf="messageListItems.length">Clear messages</button>
  </mat-card-actions>

  <mat-card-actions>
    <mat-checkbox [formControlName]="FOLLOW_TAIL">Follow tail</mat-checkbox>
  </mat-card-actions>

  <mat-card-footer *ngIf="subscribeError">
    <section class="error">
      {{subscribeError}}
    </section>
  </mat-card-footer>
</mat-card>
